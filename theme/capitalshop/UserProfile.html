<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ملفي الشخصي</title>

    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/icon/favicon.png" />
    <!-- CSS -->
    <link rel="stylesheet" href="DornoStyle/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="DornoStyle/assets/css/owl.carousel.min.css" />
    <link rel="stylesheet" href="DornoStyle/assets/css/slick.css" />
    <link rel="stylesheet" href="DornoStyle/assets/css/magnific-popup.css" />
    <link rel="stylesheet" href="DornoStyle/assets/css/font.awesome.css" />
    <link rel="stylesheet" href="DornoStyle/assets/css/ionicons.min.css" />
    <link rel="stylesheet" href="DornoStyle/assets/css/animate.css" />
    <link rel="stylesheet" href="DornoStyle/assets/css/jquery-ui.min.css" />
    <link rel="stylesheet" href="DornoStyle/assets/css/slinky.menu.css" />
    <link rel="stylesheet" href="DornoStyle/assets/css/plugins.css" />
    <link rel="stylesheet" href="DornoStyle/assets/css/style.css" />
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="DornoStyle/assets/js/vendor/modernizr-3.7.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Cairo', sans-serif;
            color: #333;
        }
        .card-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fd0d0d;
        }
        .nav-tabs .nav-link {
            color: #fd0d0d;
        }
        .nav-tabs .nav-link.active {
            background-color: #fd0d0d;
            color: #fff;
        }
        table th, table td {
            text-align: center;
            vertical-align: middle;
        }
        .main-body {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            padding: 20px;
        }
        .profile-img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            object-fit: cover;
            border: 3px solid #fd0d0d;
        }
        h2, p {
            margin-top: 0;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .breadcrumb_content ul li::before {
  position: absolute;
  content: "";
  right: 0;
  top: 50%;
  transform: translatey(-50%);
}
a {
    color: #212529;
    text-decoration: none;
}
.breadcrumb_content ul li {
    display: inline-block;
    text-transform: capitalize;
    font-size: 18px;
    margin-right: 27px;
  padding-right: 0px !important; 
    position: relative;
    margin-top: 10px;
}

        .header-top {
            background-color: #343a40;
            color: #fff;
            padding: 10px 0;
        }
        .header-top ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
        }
        .header-top ul li {
            margin-right: 20px;
        }
        .header-top ul li a {
            color: #000000;
            text-decoration: none;
        }
        .header-top ul li a:hover {
            color: #141414;
        }
        .header-bottom {
            background-color: #000000;
            color: #fff;
            padding: 10px 0;
        }
        .header-bottom a {
            color: #121212;
            text-decoration: underline;
        }
    </style>
</head>
<body>
  <!--header area start-->
   <!--header area start-->
   <div class="header-top d-none d-sm-block">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="header-info-left">
                        <ul>
                            <li><a href="CleanOut.html#faq">الأسئلة الشائعة</a></li>
                            <li><a href="About1.html">معلومات عنا</a></li>
                       
                        </ul>
                    
                    </div>
                    <div class="header-info-right d-flex">
                       
                        <ul class="header-social">
                            <li><a href="https://web.facebook.com/RawaahAbdAlrahman"><i class="fab fa-facebook"></i></a></li>
                            <li><a href="https://www.instagram.com/"><i class="fab fa-instagram"></i></a></li>
                  
                            <li><a href="https://www.linkedin.com/in/rawa-ah-a-331b8023b/"><i class="fab fa-linkedin-in"></i></a></li>
                            <li><a href="https://www.youtube.com/@rawaahababneh4863"><i class="fab fa-youtube"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="header-bottom text-center">
    <p  style="color: #fffafa;" dir="rtl">تخفيضات تصل إلى 50% أسرع! العرض لفترة محدودة <a href="categories.html" class="browse-btn">تسوق الآن</a></p>
</div>

    <!--header area end-->

    <!--breadcrumbs area start-->
    <div class="breadcrumbs_area">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="breadcrumb_content">
                        <h3>حسابي</h3>
                        <ul>
                            <li><a href="index.html">الرئيسية/</a></li>
                            <li>حسابي</li>
                     
                            
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--breadcrumbs area end-->
<div class="container mt-5">
    <div class="text-center mb-4">
        <h2  style="color: black;">ملفي الشخصي</h2>
        <p class="text-muted">يسرنا رؤيتك هنا! استكشف ملفك الشخصي واطلع على كل جديد.</p>
    </div>

    <div id="user-info" class="alert alert-danger" style="display: none;"></div>

    <div class="card mb-4 main-body">
        <div class="row g-0">
            <div class="col-md-8">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-user-circle me-2"></i>معلومات المستخدم</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <p style="margin-top: 20%"><strong>الاسم الأول:</strong> <span id="displayFirstName"></span></p>
                            <p style="margin-top: 20%"><strong>اسم العائلة:</strong> <span id="displayLastName"></span></p>
                            <p style="margin-top: 20%"><strong>اسم المستخدم:</strong> <span id="username"></span></p>
                            <p style="margin-top: 20%"><strong>البريد الإلكتروني:</strong> <span id="email"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p style="margin-top: 20%"><strong>رقم الهاتف:</strong> <span id="phone"></span></p>
                            <p style="margin-top: 20%"><strong>العنوان:</strong> <span id="address"></span></p>
                            <p style="margin-top: 20%"><strong>الجنس:</strong> <span id="gender"></span></p>
                            <p style="margin-top: 20%"><strong>النقاط:</strong> <span id="points"></span></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <img src="" id="profile-img" class="profile-img" alt="صورة المستخدم">
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs mb-3" id="userDetailsTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders" type="button">الطلبات</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="sale-requests-tab" data-bs-toggle="tab" data-bs-target="#sale-requests" type="button">طلبات البيع</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="comments-tab" data-bs-toggle="tab" data-bs-target="#comments" type="button">التعليقات</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="edit-profile-tab" data-bs-toggle="tab" data-bs-target="#edit-profile" type="button">تعديل الملف</button>
        </li>
    </ul>

    <div class="tab-content" id="userDetailsTabContent">
        <div class="tab-pane fade show active" id="orders" role="tabpanel">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>الحالة</th>
                        <th>المبلغ الإجمالي</th>
                        <th>تاريخ الطلب</th>
                    </tr>
                </thead>
                <tbody id="orders-table-body"></tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="sale-requests" role="tabpanel">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>اسم المنتج</th>
                        <th>تاريخ الطلب</th>
                        <th>الحالة</th>
                    </tr>
                </thead>
                <tbody id="sale-requests-table-body"></tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="comments" role="tabpanel">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>التعليق</th>
                        <th>التاريخ</th>
                    </tr>
                </thead>
                <tbody id="comments-table-body"></tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="edit-profile" role="tabpanel">
            <div class="container">
                <div class="main-body">
                    <h2>تعديل الملف الشخصي</h2>
                    <form id="editProfileForm">
                        <div class="mb-3">
                            <label for="editFirstName" class="form-label">الاسم الأول</label>
                            <input type="text" class="form-control" id="editFirstName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editLastName" class="form-label">اسم العائلة</label>
                            <input type="text" class="form-control" id="editLastName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editUserName" class="form-label">اسم المستخدم</label>
                            <input type="text" class="form-control" id="editUserName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editEmail" class="form-label">البريد الإلكتروني</label>
                            <input type="email" class="form-control" id="editEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="editPhoneNumber" class="form-label">رقم الهاتف</label>
                            <input type="text" class="form-control" id="editPhoneNumber" required>
                        </div>
                        <div class="mb-3">
                            <label for="editAddress" class="form-label">العنوان</label>
                            <input type="text" class="form-control" id="editAddress" required>
                        </div>
                        <div class="mb-3">
                            <label for="editGender" class="form-label">الجنس</label>
                            <select class="form-select" id="editGender" required>
                                <option value="" disabled selected>اختر الجنس</option>
                                <option value="Male">ذكر</option>
                                <option value="Female">أنثى</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editPoints" class="form-label">النقاط</label>
                            <input type="number" class="form-control" id="editPoints" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label for="editImage" class="form-label">صورة الملف الشخصي</label>
                            <input type="file" class="form-control" id="editImage">
                        </div>
                        <button type="submit" class="btn btn-primary">حفظ</button>
                        <a href="UserProfile.html" class="btn btn-secondary">إلغاء</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<br>
<br>
<br>
<br>

<footer>
    <div class="footer-wrapper gray-bg">
        <div class="footer-area footer-padding">

            <!-- قسم الاشتراك في النشرة الإخبارية -->
            <section class="subscribe-area">
                <div class="container">
                    <div class="row justify-content-between subscribe-padding">
                        <div class="col-xxl-2 col-xl-2 col-lg-4">
                            <div class="footer-social">
                                <a href="https://bit.ly/sai4ull"><i class="fab fa-facebook"></i></a>
                                <a href="#"><i class="fab fa-instagram"></i></a>
                                <a href="#"><i class="fab fa-youtube"></i></a>
                            </div>
                        </div>
                       
                        <div class="col-xxl-5 col-xl-6 col-lg-7 col-md-9">
                            <div class="subscribe-caption">
                                <form action="#">
                                    <input type="text" placeholder="أدخل بريدك الإلكتروني">
                                    <button class="subscribe-btn">اشترك</button>
                                </form>
                            </div>
                        </div>
                        <div class="col-xxl-3 col-xl-3 col-lg-4">
                            <div class="subscribe-caption">
                                <h3>اشترك في النشرة الإخبارية</h3>
                                <p>اشترك في النشرة الإخبارية للحصول على خصم 5% على جميع المنتجات.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- قسم معلومات الفوتر -->
            <div class="container">
                <div class="row justify-content-between">
                  
                    <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle">
                                <h4>تسوق للرجال</h4>
                                <ul>
                                    <li><a href="#">أزياء الملابس</a></li>
                                    <li><a href="#">شتاء</a></li>
                                    <li><a href="#">صيف</a></li>
                                    <li><a href="#">رسمية</a></li>
                                    <li><a href="#">عادية</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle" >
                                <h4>تسوق للنساء</h4>
                                <ul>
                                    <li><a href="#">أزياء الملابس</a></li>
                                    <li><a href="#">شتاء</a></li>
                                    <li><a href="#">صيف</a></li>
                                    <li><a href="#">رسمية</a></li>
                                    <li><a href="#">عادية</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle">
                                <h4>معلومات</h4>
                                <ul>
                                    <li><a href="#">من نحن</a></li>
                                    <li><a href="#">سياسة الخصوصية</a></li>
                                    <li><a href="#">الشروط والأحكام</a></li>
                                    <li><a href="#">اتصل بنا</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-6 col-sm-8">
                        <div class="single-footer-caption mb-50">
                            <div class="single-footer-caption mb-20">
                                <div class="footer-logo mb-35">
                                    <a href="index.html"><img src="assets/img/logo/logo2_footer.png" alt="شعار"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</footer>

<div id="back-top">
    <a class="wrapper" title="Go to Top" href="#">
    <div class="arrows-container">
    <div class="arrow arrow-one">
    </div>
    <div class="arrow arrow-two">
    </div>
    </div>
    </a>
    </div>
    <!-- استدعاء مكتبة سوابر قبل تقعيله -->
      <!-- Swiper JS -->
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="index.js"></script>
    <script src="assets/js/vendor/modernizr-3.5.0.min.js"></script>
    <script src="assets/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    
    <script src="assets/js/owl.carousel.min.js"></script>
    <script src="assets/js/slick.min.js"></script>
    <script src="assets/js/jquery.slicknav.min.js"></script>
    
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/jquery.magnific-popup.js"></script>
    <script src="assets/js/jquery.nice-select.min.js"></script>
    <script src="assets/js/jquery.counterup.min.js"></script>
    <script src="assets/js/waypoints.min.js"></script>
    <script src="assets/js/price_rangs.js"></script>
    
    <script src="assets/js/contact.js"></script>
    <script src="assets/js/jquery.form.js"></script>
    <script src="assets/js/jquery.validate.min.js"></script>
    <script src="assets/js/mail-script.js"></script>
    <script src="assets/js/jquery.ajaxchimp.min.js"></script>
    
    <script src="assets/js/plugins.js"></script>
    <script src="assets/js/main.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        fetchUserData();

        function fetchUserData() {
            const userId = localStorage.getItem("UserId");
            fetch(`https://localhost:44332/api/Users/UserDetails/${userId}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('displayFirstName').innerText = data.firstName;
                    document.getElementById('displayLastName').innerText = data.lastName;
                    document.getElementById('username').innerText = data.userName;
                    document.getElementById('email').innerText = data.email;
                    document.getElementById('phone').innerText = data.phoneNumber;
                    document.getElementById('address').innerText = data.address;
                    document.getElementById('gender').innerText = data.gender;
                    document.getElementById('points').innerText = data.points;

                    const defaultImagePath = '../../../../Backend/Masterpiece/Masterpiece/Uploads/';
                    document.getElementById('profile-img').src = data.image ? defaultImagePath + data.image : '../../../../Backend/Masterpiece/Masterpiece/Uploads/Profile.jpg';

                    fillOrdersTable(data.orders);
                    fillSaleRequestsTable(data.saleRequests);
                    fillCommentsTable(data.comments);
                    populateForm(data);
                })
                .catch(error => {
                    console.error('Error fetching user data:', error);
                    document.getElementById('user-info').style.display = 'block';
                    document.getElementById('user-info').innerText = 'فشل في تحميل بيانات المستخدم.';
                });
        }

        function fillOrdersTable(orders) {
            const tableBody = document.getElementById('orders-table-body');
            tableBody.innerHTML = '';
            orders.forEach((order, index) => {
                const row = `<tr>
                    <td>${index + 1}</td>
                    <td>${order.status}</td>
                    <td>${order.amount}</td>
                    <td>${order.date}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }

        function fillSaleRequestsTable(saleRequests) {
            const tableBody = document.getElementById('sale-requests-table-body');
            tableBody.innerHTML = '';
            saleRequests.forEach((request, index) => {
                const row = `<tr>
                    <td>${index + 1}</td>
                    <td>${request.product.name}</td>
                    <td>${request.requestDate}</td>
                    <td>${request.status}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }

        function fillCommentsTable(comments) {
            const tableBody = document.getElementById('comments-table-body');
            tableBody.innerHTML = '';
            comments.forEach((comment, index) => {
                const row = `<tr>
                    <td>${index + 1}</td>
                    <td>${comment.comment1}</td>
                    <td>${comment.date}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }

        function populateForm(user) {
            document.getElementById('editFirstName').value = user.firstName;
            document.getElementById('editLastName').value = user.lastName;
            document.getElementById('editUserName').value = user.userName;
            document.getElementById('editEmail').value = user.email;
            document.getElementById('editPhoneNumber').value = user.phoneNumber;
            document.getElementById('editAddress').value = user.address;
            document.getElementById('editGender').value = user.gender;
            document.getElementById('editPoints').value = user.points;
        }

        async function saveUserData(event) {
            event.preventDefault();
            const userId = localStorage.getItem("UserId");
            const url = `https://localhost:44332/api/Users/${userId}`;
            const formData = new FormData();
            formData.append('FirstName', document.getElementById('editFirstName').value);
            formData.append('LastName', document.getElementById('editLastName').value);
            formData.append('UserName', document.getElementById('editUserName').value);
            formData.append('Email', document.getElementById('editEmail').value);
            formData.append('PhoneNumber', document.getElementById('editPhoneNumber').value);
            formData.append('Address', document.getElementById('editAddress').value);
            formData.append('Gender', document.getElementById('editGender').value);
            formData.append('Points', document.getElementById('editPoints').value);

            const imageFile = document.getElementById('editImage').files[0];
            if (imageFile) {
                formData.append('Image', imageFile);
            }

            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                alert('تم تحديث بيانات المستخدم بنجاح!');
                window.location.href = 'UserProfile.html';
            } catch (error) {
                console.error('Error saving user data:', error);
                alert('فشل في تحديث بيانات المستخدم.');
            }
        }

        document.getElementById('editProfileForm').addEventListener('submit', saveUserData);
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>